!function(){const e=["https://api.codetabs.com/v1/proxy?quest=","https://thingproxy.freeboard.io/fetch/","https://api.allorigins.win/raw?url="],t=new Map;async function n(n,i={}){const a=`${n}_${JSON.stringify(i)}`,o=t.get(a);if(o&&Date.now()-o.timestamp<3e5)return o.data;const s=new URL(`https://melolo-api-azure.vercel.app/api/melolo/${n}`);Object.entries(i).forEach(([e,t])=>{null!=t&&s.searchParams.append(e,t)});const d=s.toString();let r=null;try{const e=await fetch(d,{headers:{Accept:"application/json","Cache-Control":"max-age=300"},signal:AbortSignal.timeout(8e3)});e.ok&&(r=await e.json())}catch(e){}if(!r)for(const t of e)try{const e=t+encodeURIComponent(d),n=await fetch(e,{signal:AbortSignal.timeout(8e3)});if(n.ok&&(r=await n.json(),r))break}catch(e){continue}if(!r)throw new Error("Failed to fetch data");return t.set(a,{data:r,timestamp:Date.now()}),r}async function i(){try{return(await n("latest")).books||[]}catch(e){throw e}}async function a(){try{return(await n("trending")).books||[]}catch(e){throw e}}async function o(e,t=20,i=0){try{const a=await n("search",{query:e,limit:t,offset:i}),o=(a?.data?.search_data||[]).flatMap(e=>e.books||[]);return{results:o,hasMore:a?.data?.has_more||!1,total:o.length}}catch(e){throw e}}async function s(e){try{const t=await n(`detail/${e}`),i=t?.data?.video_data||{};return{id:e,title:i.series_title||"Unknown",description:i.series_intro||"",thumbnail:i.series_cover||i.thumb_url||"",episodes:i.video_list||[],totalEpisodes:i.video_list?.length||0}}catch(e){throw e}}async function d(e){try{const t=await n(`stream/${e}`),i=t?.data;if(!i)throw new Error("No video data found");const a={mainUrl:i.main_url?r(i.main_url):null,sources:[],autoDefinition:null};let o=i.video_model;if("string"==typeof o)try{o=JSON.parse(o)}catch(e){o=null}return o&&o.video_list&&(Object.entries(o.video_list).forEach(([e,t])=>{if(t?.main_url){const n=r(t.main_url);if(n){const i=t.definition||e.replace("video_","")+"p";a.sources.push({resolution:i,label:i,url:n})}}}),a.autoDefinition=o.auto_definition),a.sources.sort((e,t)=>{const n=parseInt(e.resolution)||0;return(parseInt(t.resolution)||0)-n}),0===a.sources.length&&a.mainUrl&&a.sources.push({resolution:"auto",label:"Auto",url:a.mainUrl}),a}catch(e){throw new Error("Failed to load video sources")}}function r(e){if(!e)return null;if(e.startsWith("http"))return e;try{return atob(e)}catch(t){return e}}function c(e,t={}){if(!e)return"";const{width:n=400,quality:i=80,format:a="jpg"}=t;return`https://images.weserv.nl/?url=${encodeURIComponent(e)}&w=${n}&q=${i}&output=${a}`}function l(){t.clear()}function u(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function m(e,t){if(!t||!e)return u(e);const n=new RegExp(`(${t})`,"gi");return u(e).replace(n,'<em class="highlight">$1</em>')}function p(e){return e?e>=1e6?(e/1e6).toFixed(1)+"Jt":e>=1e3?(e/1e3).toFixed(1)+"rb":e.toString():"0"}function v(e="Memuat..."){const t=document.getElementById("content");t&&(t.innerHTML=`\n        <div class="loading">\n            <div class="loading-spinner"></div>\n            <p>${u(e)}</p>\n        </div>\n    `)}function y(e){const t=document.getElementById("content");t&&(t.innerHTML=`\n        <div class="empty-state">\n            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>\n            <p>${u(e)}</p>\n            <button class="retry-btn" onclick="window.location.reload()">\n                Coba Lagi\n            </button>\n        </div>\n    `)}function g(e,t="latest"){const n=document.getElementById("content");if(!n)return;if(!e||0===e.length)return void y("Tidak ada drama ditemukan");const i=document.documentElement.classList.contains("lite");let a=`<div class="${i?"grid lite":"grid"}">`;e.forEach(e=>{if(!e.book_id)return;const t=b(e),n=m(e.search_high_light?.title?.rich_text||e.book_name,window.AppState?.searchQuery||""),o=c(e.thumb_url,{width:i?120:200,quality:i?60:80});a+=`\n            <div class="card" data-book-id="${e.book_id}">\n                ${t}\n                <div class="card-img">\n                    <img src="${o}" \n                         alt="${u(e.book_name)}"\n                         loading="lazy"\n                         decoding="async"\n                         onerror="this.src='https://placehold.co/${i?"120x180":"200x300"}/1e293b/94a3b8?text=${encodeURIComponent(e.book_name||"Drama")}'">\n                </div>\n                <div class="card-info">\n                    <div class="card-title">\n                        ${n}\n                    </div>\n                    <div class="card-meta">\n                        ${u(e.show_creation_status||"")}\n                    </div>\n                </div>\n            </div>\n        `}),a+="</div>",n.innerHTML=a,setTimeout(()=>{document.querySelectorAll(".card[data-book-id]").forEach(e=>{const t=e.getAttribute("data-book-id");t&&e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"drama-click",data:t}}))})})},50)}function f(e){const t=document.getElementById("content");if(!t)return;const n=document.documentElement.classList.contains("lite"),i=c(e.thumbnail,{width:300,quality:85}),a=[...e.episodes||[]].sort((e,t)=>(parseInt(e.vid_index)||0)-(parseInt(t.vid_index)||0));t.innerHTML=n?function(e,t,n){return`\n        <div class="detail-container-lite">\n            <div class="detail-header-lite">\n                <div class="detail-thumbnail-lite">\n                    <img src="${t}" \n                         alt="${u(e.title)}"\n                         loading="lazy"\n                         decoding="async">\n                </div>\n                <div class="detail-info-lite">\n                    <h2 class="detail-title">${u(e.title)}</h2>\n                    <div class="detail-episode-count">${e.totalEpisodes} Episode</div>\n                </div>\n            </div>\n            <div class="description-lite">\n                <div class="description-content-lite">\n                    ${u(e.description)}\n                </div>\n            </div>\n        </div>\n        \n        <div class="episodes-card-lite">\n            <div class="episode-list-lite">\n                ${n.map((e,t)=>h(e,t,!0)).join("")}\n            </div>\n        </div>\n    `}(e,i,a):function(e,t,n){return`\n        <div class="detail-container">\n            <div class="detail-thumbnail">\n                <img src="${t}" \n                     alt="${u(e.title)}"\n                     loading="lazy"\n                     decoding="async">\n            </div>\n            <div class="detail-info">\n                <h2 class="detail-title">${u(e.title)}</h2>\n                <div class="detail-episode-count">${e.totalEpisodes} Episode</div>\n                <div class="description-container">\n                    <div class="description-content">${u(e.description)}</div>\n                    <button class="expand-btn">\n                        <span>Selengkapnya</span>\n                        <i class="fas fa-chevron-down"></i>\n                    </button>\n                </div>\n            </div>\n        </div>\n        \n        <div class="episodes-card">\n            <div class="episode-list-container">\n                ${n.map((e,t)=>h(e,t,!1)).join("")}\n            </div>\n        </div>\n    `}(e,i,a),setTimeout(()=>{n?document.querySelectorAll(".episode-item-lite").forEach((e,t)=>{e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"episode-click",data:t}}))})}):document.querySelectorAll(".episode-item").forEach((e,t)=>{e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"episode-click",data:t}}))})}),function(){const e=document.querySelector(".description-content"),t=document.querySelector(".expand-btn");if(!e||!t)return;const n=1.5,i=window.getComputedStyle(e),a=parseFloat(i.fontSize),o=n*a*3;if(e.scrollHeight>o){e.classList.add("truncated"),t.style.display="flex";let n=!1;const i=t.querySelector("span"),a=t.querySelector("i");t.addEventListener("click",()=>{n?(e.classList.add("truncated"),i.textContent="Selengkapnya",a.className="fas fa-chevron-down",n=!1):(e.classList.remove("truncated"),i.textContent="Lebih Sedikit",a.className="fas fa-chevron-up",n=!0)})}else t.style.display="none"}()},50)}function h(e,t,n){const i=e.vid_index||t+1,a=e.duration?(o=e.duration)?`${Math.floor(o/60)}:${Math.floor(o%60).toString().padStart(2,"0")}`:"0:00":"";var o;const s="1"===e.is_new;return n?`\n            <div class="episode-item-lite" data-episode-index="${t}">\n                <div class="episode-info-lite">\n                    <div class="episode-number-lite">\n                        <span>Episode ${i}</span>\n                        ${s?'<span class="ep-badge-lite">BARU</span>':""}\n                    </div>\n                    ${e.video_title?`\n                        <div class="episode-title-lite">\n                            ${u(e.video_title)}\n                        </div>\n                    `:""}\n                    <div class="episode-meta-lite">\n                        ${a?`\n                            <span class="episode-duration-lite">\n                                <i class="far fa-clock"></i> ${a}\n                            </span>\n                        `:""}\n                        ${e.views?`\n                            <span><i class="far fa-eye"></i> ${p(e.views)}x</span>\n                        `:""}\n                    </div>\n                </div>\n                <div class="episode-play-lite">\n                    <i class="fas fa-play"></i>\n                </div>\n            </div>\n        `:`\n        <div class="episode-item" data-episode-index="${t}">\n            <div class="episode-info">\n                <div class="episode-number">\n                    <span>Episode ${i}</span>\n                    ${s?'<span class="ep-badge">BARU</span>':""}\n                </div>\n                <div class="episode-meta">\n                    ${a?`\n                        <span class="episode-duration">\n                            <i class="far fa-clock"></i> ${a}\n                        </span>\n                    `:""}\n                    ${e.upload_date?`\n                        <span><i class="far fa-calendar"></i> ${e.upload_date}</span>\n                    `:""}\n                    ${e.views?`\n                        <span><i class="far fa-eye"></i> ${p(e.views)}x</span>\n                    `:""}\n                </div>\n            </div>\n            <div class="episode-play">\n                <i class="fas fa-play"></i>\n            </div>\n        </div>\n    `}function w(e,t){const n=document.getElementById("content");if(!n)return;if(!e.results||0===e.results.length)return void y(`Tidak ada hasil untuk "${t}"`);const i=document.documentElement.classList.contains("lite"),a=i?"grid lite":"grid";let s=`\n        <div class="search-results-header">\n            <h4 style="word-break: break-word;">Hasil pencarian untuk "${u(t)}"</h4>\n        </div>\n        <div class="${a}" id="searchGrid">\n    `;e.results.forEach(e=>{if(!e.book_id)return;const n=b(e),a=m(e.search_high_light?.title?.rich_text||e.book_name,t),o=c(e.thumb_url,{width:i?120:200,quality:i?60:80});s+=`\n            <div class="card" data-book-id="${e.book_id}">\n                ${n}\n                <div class="card-img">\n                    <img src="${o}" \n                         alt="${u(e.book_name)}"\n                         loading="lazy"\n                         decoding="async">\n                </div>\n                <div class="card-info">\n                    <div class="card-title">\n                        ${a}\n                    </div>\n                    <div class="card-meta">\n                        ${u(e.show_creation_status||"")}\n                    </div>\n                </div>\n            </div>\n        `}),s+="</div>",e.hasMore&&(s+='\n            <div class="infinite-scroll-loading" id="infiniteScrollLoading" style="display: none;">\n                <div class="loading-spinner"></div>\n            </div>\n        '),n.innerHTML=s,setTimeout(()=>{document.querySelectorAll(".card[data-book-id]").forEach(e=>{const t=e.getAttribute("data-book-id");t&&e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"drama-click",data:t}}))})}),function(){if(!document.getElementById("infiniteScrollLoading"))return;let e=!1;const t=()=>{if(e)return;const t=window.scrollY||document.documentElement.scrollTop,i=document.documentElement.scrollHeight;t+window.innerHeight>=.8*i&&n()},n=async()=>{if(e||!window.AppState?.searchResults?.hasMore)return;e=!0;const t=document.getElementById("infiniteScrollLoading");t&&(t.style.display="block");try{const e=window.AppState.searchResults.results.length,t=await o(window.AppState.searchQuery,20,e);t.results&&t.results.length>0&&(window.AppState.searchResults.results=[...window.AppState.searchResults.results,...t.results],window.AppState.searchResults.hasMore=t.hasMore,i(t.results))}catch(e){console.error("Error loading more results:",e)}finally{e=!1;const t=document.getElementById("infiniteScrollLoading");t&&(t.style.display="none")}},i=e=>{const t=document.getElementById("searchGrid");if(!t)return;const n=document.documentElement.classList.contains("lite");e.forEach(e=>{if(!e.book_id)return;const i=b(e),a=m(e.search_high_light?.title?.rich_text||e.book_name,window.AppState.searchQuery),o=c(e.thumb_url,{width:n?120:200,quality:n?60:80}),s=`\n                <div class="card" data-book-id="${e.book_id}">\n                    ${i}\n                    <div class="card-img">\n                        <img src="${o}" \n                             alt="${u(e.book_name)}"\n                             loading="lazy"\n                             decoding="async">\n                    </div>\n                    <div class="card-info">\n                        <div class="card-title">\n                            ${a}\n                        </div>\n                        <div class="card-meta">\n                            ${u(e.show_creation_status||"")}\n                        </div>\n                    </div>\n                </div>\n            `;t.insertAdjacentHTML("beforeend",s)}),setTimeout(()=>{document.querySelectorAll(".card[data-book-id]").forEach(e=>{if(e.onclick)return;const t=e.getAttribute("data-book-id");t&&e.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"drama-click",data:t}}))})})},10)};let a;window.addEventListener("scroll",()=>{clearTimeout(a),a=setTimeout(t,200)}),t()}()},50)}async function E(e){if(!window.AppState?.currentDrama?.episodes)return;const t=window.AppState.currentDrama.episodes[e];if(!t?.vid)return;const n=document.querySelector(`[data-episode-index="${e}"]`);if(n){n.classList.add("loading");const e=n.querySelector(".episode-play i");e&&(e.className="fas fa-spinner fa-spin")}try{B(t,await d(t.vid),e),window.currentEpisodeIndex=e}catch(e){if(n){n.classList.remove("loading");const e=n.querySelector(".episode-play i");e&&(e.className="fas fa-play")}alert("Gagal memuat video. Silakan coba lagi.")}}function b(e){const t=[];if("1"===e.is_hot&&t.push({type:"hot",text:"HOT"}),"1"===e.is_new_book&&t.push({type:"new",text:"NEW"}),"1"===e.is_exclusive&&t.push({type:"exclusive",text:"EXCLUSIVE"}),"1"===e.is_dubbed&&t.push({type:"dub",text:"DUB"}),"1"===e.is_native&&t.push({type:"original",text:"ORIGINAL"}),"1"===e.in_bookshelf&&t.push({type:"saved",text:"SAVED"}),0===t.length)return"";return`<div class="badges">${t.map(e=>`<span class="badge ${e.type}">${e.text}</span>`).join("")}</div>`}window.apiUtils={smartFetch:n,clearCache:l,cacheSize:()=>t.size},window.components={renderGrid:g,renderDetail:f,renderSearchResults:w};const L={currentEpisode:null,sources:null,currentTime:0,isPlaying:!1,isLoading:!1,currentEpisodeIndex:-1,currentResolution:"auto",wasPlayingBeforeSwitch:!1};function k(){let e=document.getElementById("videoContainer");e||(e=document.createElement("div"),e.id="videoContainer",e.className="video-container",e.style.display="none",document.body.appendChild(e)),document.addEventListener("fullscreenchange",z),document.addEventListener("webkitfullscreenchange",z)}function B(e,t,n){L.currentEpisode=e,L.sources=t,L.currentEpisodeIndex=n,L.currentTime=0,L.isLoading=!0,L.wasPlayingBeforeSwitch=!1;const i=document.getElementById("videoContainer");if(!i)return;const a=document.documentElement.classList.contains("lite"),o=e.video_title||`Episode ${e.vid_index||n+1}`;let s;s=a?function(e,t){const n=t.sources||[];let i="";n.length>0&&n.forEach(e=>{const t=e.resolution===L.currentResolution;i+=`<option value="${e.resolution}" ${t?"selected":""}>${e.label}</option>`});if(t.mainUrl){const e="auto"===L.currentResolution;i=`<option value="auto" ${e?"selected":""}>Auto</option>`+i}return`\n        <div class="video-player-wrapper lite">\n            <video \n                id="videoPlayer" \n                class="video-player" \n                controls \n                playsinline \n                webkit-playsinline\n                preload="auto"\n            >\n                Your browser does not support the video tag.\n            </video>\n            \n            <div class="lite-controls">\n                <button class="lite-btn back-btn" id="playerBackBtn">\n                    <i class="fas fa-arrow-left"></i>\n                </button>\n                \n                <div class="episode-info">\n                    <div class="episode-title">${u(e)}</div>\n                        \n                    ${n.length>0||t.mainUrl?`\n                        <select class="lite-select" id="resolutionSelect">\n                            ${i}\n                        </select>\n                    `:""}\n                </div>\n            </div>\n            \n            <div class="lite-loading" id="liteLoading">\n                <div class="loading-spinner"></div>\n            </div>\n        </div>\n    `}(o,t):function(e,t){const n=t.sources||[];let i="";n.length>0&&n.forEach(e=>{const t=e.resolution===L.currentResolution;i+=`<option value="${e.resolution}" ${t?"selected":""}>${e.label}</option>`});if(t.mainUrl){const e="auto"===L.currentResolution;i=`<option value="auto" ${e?"selected":""}>Auto</option>`+i}return`\n        <div class="video-player-wrapper">\n            <video \n                id="videoPlayer" \n                class="video-player" \n                playsinline \n                webkit-playsinline\n                preload="auto"\n            >\n                Your browser does not support the video tag.\n            </video>\n            \n            <div class="player-loading" id="playerLoading">\n                <div class="loading-spinner-large"></div>\n                <div class="loading-text">Memuat video...</div>\n            </div>\n            \n            <div class="video-controls" id="videoControls">\n                <div class="controls-top">\n                    <button class="control-btn back-btn" id="playerBackBtn">\n                        <i class="fas fa-arrow-left"></i>\n                    </button>\n                    \n                    <div class="episode-info">\n                        <div class="episode-title">${u(e)}</div>\n                        ${n.length>0||t.mainUrl?`\n                            <select class="resolution-select" id="resolutionSelect">\n                                ${i}\n                            </select>\n                        `:""}\n                    </div>\n                </div>\n                \n                <div class="controls-center">\n                    <button class="control-btn-large" id="prevBtn">\n                        <i class="fas fa-backward"></i>\n                        <span>10s</span>\n                    </button>\n                    \n                    <button class="play-btn" id="playBtn">\n                        <i class="fas fa-play"></i>\n                    </button>\n                    \n                    <button class="control-btn-large" id="nextBtn">\n                        <i class="fas fa-forward"></i>\n                        <span>10s</span>\n                    </button>\n                </div>\n                \n                <div class="controls-bottom">\n                    <div class="progress-container">\n                        <div class="progress-bar-bg">\n                            <div class="progress-buffered" id="progressBuffered"></div>\n                            <div class="progress-current" id="progressCurrent"></div>\n                        </div>\n                        <input \n                            type="range" \n                            id="progressSlider" \n                            class="progress-slider" \n                            min="0" \n                            max="100" \n                            value="0"\n                            step="0.1"\n                        >\n                    </div>\n                    <div class="video-time" id="videoTime">0:00 / 0:00</div>\n                    \n                    <div class="controls-right">\n                        <div class="volume-container">\n                            <button class="control-btn volume-btn" id="volumeBtn">\n                                <i class="fas fa-volume-up"></i>\n                            </button>\n                            <div class="volume-slider-container">\n                                <input \n                                    type="range" \n                                    id="volumeSlider" \n                                    class="volume-slider" \n                                    min="0" \n                                    max="100" \n                                    value="80"\n                                >\n                            </div>\n                        </div>\n                        <button class="control-btn fullscreen-btn" id="fullscreenBtn">\n                            <i class="fas fa-expand"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="player-error" id="playerError" style="display: none;">\n                <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>\n                <div class="error-message">Gagal memuat video</div>\n                <button class="retry-btn" id="retryBtn">Coba Lagi</button>\n            </div>\n        </div>\n    `}(o,t),i.innerHTML=s,i.style.display="block",document.body.style.overflow="hidden",setTimeout(()=>{!function(){const e=document.getElementById("videoPlayer");if(!e)return;const t=localStorage.getItem("playerVolume");null!==t&&(e.volume=parseFloat(t));const n=document.getElementById("volumeSlider");n&&(n.value=100*e.volume)}(),S(),function(){const e=document.getElementById("videoPlayer"),t=document.getElementById("playBtn"),n=document.getElementById("playerBackBtn"),i=document.getElementById("resolutionSelect"),a=document.getElementById("fullscreenBtn"),o=document.getElementById("prevBtn"),s=document.getElementById("nextBtn"),d=document.getElementById("progressSlider"),r=document.getElementById("volumeBtn"),c=document.getElementById("volumeSlider"),l=document.getElementById("retryBtn");if(!e)return;e.addEventListener("loadeddata",I),e.addEventListener("canplay",$),e.addEventListener("playing",x),e.addEventListener("pause",A),e.addEventListener("timeupdate",_),e.addEventListener("durationchange",C),e.addEventListener("progress",T),e.addEventListener("ended",P),e.addEventListener("error",q),e.addEventListener("waiting",D),e.addEventListener("seeking",R),e.addEventListener("seeked",F),t?t.addEventListener("click",N):e.addEventListener("click",N);n&&n.addEventListener("click",te);i&&i.addEventListener("change",U);a&&a.addEventListener("click",H);o&&o.addEventListener("click",()=>G(-10));s&&s.addEventListener("click",()=>G(10));d&&(d.addEventListener("input",j),d.addEventListener("change",Q));r&&r.addEventListener("click",O);c&&c.addEventListener("input",V);l&&l.addEventListener("click",W);document.addEventListener("keydown",J);const u=document.getElementById("videoContainer");if(u){let p;function m(){const e=document.getElementById("videoControls");e&&(e.classList.add("visible"),clearTimeout(p),p=setTimeout(()=>{L.isLoading||e.classList.remove("visible")},3e3))}u.addEventListener("mousemove",m),u.addEventListener("touchstart",m)}}()},100)}function S(){const e=document.getElementById("videoPlayer"),t=document.getElementById("playerLoading")||document.getElementById("liteLoading");if(!e)return;t&&(t.style.display="flex");const n=document.getElementById("resolutionSelect");let i=null;if(n){const e=n.value;L.currentResolution=e,i="auto"===e&&L.sources.mainUrl?L.sources.mainUrl:L.sources.sources?.find(t=>t.resolution===e)?.url}else L.sources.mainUrl?(i=L.sources.mainUrl,L.currentResolution="auto"):L.sources.sources?.[0]?.url&&(i=L.sources.sources[0].url,L.currentResolution=L.sources.sources[0].resolution);if(!i)return void K("Tidak ada sumber video tersedia");e.src&&e.src!==i&&(L.wasPlayingBeforeSwitch=!e.paused,L.currentTime=e.currentTime),e.src=i,e.load();const a=()=>{e.currentTime=L.currentTime,(L.wasPlayingBeforeSwitch||L.isPlaying)&&e.play().catch(e=>{L.isPlaying=!1,Y()}),e.removeEventListener("loadeddata",a)};if(e.addEventListener("loadeddata",a),!L.wasPlayingBeforeSwitch){const t=e.play();void 0!==t&&t.catch(e=>{L.isPlaying=!1,Y()})}}function I(){L.isLoading=!1;const e=document.getElementById("playerLoading")||document.getElementById("liteLoading");e&&(e.style.display="none");const t=document.getElementById("playerError");t&&(t.style.display="none")}function $(){L.isLoading=!1;const e=document.getElementById("playerLoading")||document.getElementById("liteLoading");e&&(e.style.display="none"),X()}function x(){L.isPlaying=!0,L.isLoading=!1,Y();const e=document.getElementById("playerLoading")||document.getElementById("liteLoading");e&&(e.style.display="none")}function A(){L.isPlaying=!1,Y()}function _(){const e=document.getElementById("videoPlayer");e&&(L.currentTime=e.currentTime,function(){const e=document.getElementById("videoPlayer"),t=document.getElementById("progressSlider"),n=document.getElementById("progressCurrent");if(!e||!e.duration)return;const i=L.currentTime/e.duration*100;t&&(t.value=i);n&&(n.style.width=`${i}%`)}(),X())}function C(){X()}function T(){const e=document.getElementById("videoPlayer");if(!e)return;const t=document.getElementById("progressBuffered");if(t&&e.duration>0&&e.buffered.length>0){const n=e.buffered.end(e.buffered.length-1)/e.duration*100;t.style.width=`${n}%`}}function P(){L.isPlaying=!1,Y();const e=L.currentEpisodeIndex+1;e<(window.AppState?.currentDrama?.episodes?.length||0)&&function(e){const t=document.getElementById("videoContainer");if(!t)return;const n=window.AppState.currentDrama.episodes[e],i=n.video_title||`Episode ${n.vid_index||e+1}`,a=document.createElement("div");a.className="next-episode-confirmation",a.innerHTML=`\n        <div class="confirmation-content">\n            <div class="confirmation-title">Episode Berikutnya</div>\n            <div class="confirmation-text">${u(i)}</div>\n            <div class="confirmation-timer" id="countdownTimer">5</div>\n            <div class="confirmation-buttons">\n                <button class="confirmation-btn cancel-btn" id="cancelNextBtn">Batalkan</button>\n                <button class="confirmation-btn playnext-btn" id="playNextBtn">Putar Sekarang</button>\n            </div>\n        </div>\n    `,t.appendChild(a);let o,s=5;const d=()=>{const e=document.getElementById("countdownTimer");e&&(e.textContent=s)};o=setInterval(()=>{s--,d(),s<=0&&(clearInterval(o),M(e))},1e3),document.getElementById("playNextBtn")?.addEventListener("click",()=>{clearInterval(o),M(e)}),document.getElementById("cancelNextBtn")?.addEventListener("click",()=>{clearInterval(o),a.remove()})}(e)}function M(e){const t=document.querySelector(".next-episode-confirmation");t&&t.remove(),window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"episode-click",data:e}}))}function q(e){L.isLoading=!1,K("Gagal memuat video. Coba resolusi lain.");const t=document.getElementById("playerLoading")||document.getElementById("liteLoading");t&&(t.style.display="none")}function D(){L.isLoading=!0;const e=document.getElementById("playerLoading")||document.getElementById("liteLoading");e&&(e.style.display="flex")}function R(){L.isLoading=!0}function F(){L.isLoading=!1;const e=document.getElementById("playerLoading")||document.getElementById("liteLoading");e&&(e.style.display="none")}function N(){const e=document.getElementById("videoPlayer");e&&(e.paused||e.ended?e.play().catch(e=>{const t=document.getElementById("playBtn");t&&(t.innerHTML='<i class="fas fa-play"></i>')}):e.pause())}function U(e){const t=e.target.value,n=document.getElementById("videoPlayer");if(!n)return;L.currentTime=n.currentTime,L.wasPlayingBeforeSwitch=!n.paused,L.currentResolution=t;const i=document.getElementById("playerLoading")||document.getElementById("liteLoading");i&&(i.style.display="flex");let a=null;if(a="auto"===t&&L.sources.mainUrl?L.sources.mainUrl:L.sources.sources?.find(e=>e.resolution===t)?.url,!a)return;n.src=a,n.load();const o=()=>{n.currentTime=L.currentTime,L.wasPlayingBeforeSwitch&&n.play().catch(e=>{L.isPlaying=!1,Y()}),i&&(i.style.display="none"),n.removeEventListener("loadeddata",o)};n.addEventListener("loadeddata",o)}function H(){const e=document.getElementById("videoContainer");e&&(document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())}function z(){const e=document.getElementById("fullscreenBtn");e&&(document.fullscreenElement?e.innerHTML='<i class="fas fa-compress"></i>':e.innerHTML='<i class="fas fa-expand"></i>')}function G(e){const t=document.getElementById("videoPlayer");if(!t)return;const n=t.currentTime+e;t.currentTime=Math.max(0,Math.min(n,t.duration||1/0))}function j(e){if(!document.getElementById("videoPlayer"))return;const t=parseFloat(e.target.value),n=document.getElementById("progressCurrent");n&&(n.style.width=`${t}%`)}function Q(e){const t=document.getElementById("videoPlayer");if(!t||!t.duration)return;const n=parseFloat(e.target.value)/100*t.duration;t.currentTime=n}function O(){const e=document.getElementById("videoPlayer"),t=document.getElementById("volumeBtn");e&&t&&(e.muted=!e.muted,t.innerHTML=e.muted?'<i class="fas fa-volume-mute"></i>':'<i class="fas fa-volume-up"></i>')}function V(e){const t=document.getElementById("videoPlayer"),n=document.getElementById("volumeBtn");if(!t||!n)return;const i=parseInt(e.target.value)/100;t.volume=i,t.muted=0===i,localStorage.setItem("playerVolume",i.toString()),n.innerHTML=0===i?'<i class="fas fa-volume-mute"></i>':'<i class="fas fa-volume-up"></i>'}function W(){const e=document.getElementById("playerError");e&&(e.style.display="none"),S()}function J(e){if(document.getElementById("videoPlayer")&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key.toLowerCase()){case" ":case"k":e.preventDefault(),N();break;case"f":e.preventDefault(),H();break;case"m":e.preventDefault(),O();break;case"arrowleft":e.preventDefault(),G(-5);break;case"arrowright":e.preventDefault(),G(5);break;case"arrowup":e.preventDefault(),Z(.1);break;case"arrowdown":e.preventDefault(),Z(-.1);break;case"escape":document.fullscreenElement&&H()}}function Y(){const e=document.getElementById("playBtn");e&&(e.innerHTML=L.isPlaying?'<i class="fas fa-pause"></i>':'<i class="fas fa-play"></i>')}function X(){const e=document.getElementById("videoPlayer"),t=document.getElementById("videoTime");if(!e||!t)return;const n=ee(L.currentTime),i=ee(e.duration||0);t.textContent=`${n} / ${i}`}function K(e){const t=document.getElementById("playerError");if(t){const n=t.querySelector(".error-message");n&&(n.textContent=e),t.style.display="flex"}}function Z(e){const t=document.getElementById("videoPlayer"),n=document.getElementById("volumeSlider");if(!t||!n)return;let i=t.volume+e;i=Math.max(0,Math.min(1,i)),t.volume=i,n.value=100*i,localStorage.setItem("playerVolume",i.toString())}function ee(e){if(!e||isNaN(e))return"0:00";const t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60);return t>0?`${t}:${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${n}:${i.toString().padStart(2,"0")}`}function u(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function te(){const e=document.getElementById("videoContainer");if(!e)return;const t=document.getElementById("videoPlayer");t&&(L.currentTime=t.currentTime,t.pause(),t.src="",t.load()),document.fullscreenElement&&document.exitFullscreen(),e.style.display="none",e.innerHTML="",document.body.style.overflow="",document.removeEventListener("keydown",J),L.currentEpisode=null,L.sources=null,L.isPlaying=!1,L.isLoading=!1,L.wasPlayingBeforeSwitch=!1,function(e){if(document.querySelectorAll(".episode-item, .episode-item-lite").forEach(e=>{e.classList.remove("playing")}),e>=0){const t=document.querySelector(`[data-episode-index="${e}"]`);t&&(t.classList.add("playing"),t.scrollIntoView({behavior:"smooth",block:"nearest"}))}}(-1)}function ne(){const e=navigator.deviceMemory&&navigator.deviceMemory<=3,t=/Android [5-8]/i.test(navigator.userAgent),n=window.innerWidth<=360,i=e||t||n;return i&&document.documentElement.classList.add("lite"),i}function ie(e){const t=document.getElementById("searchInput"),n=document.getElementById("searchBtn");t&&n&&(n.addEventListener("click",()=>{const e=t.value.trim();e&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"search",data:e}}))}),t.addEventListener("keypress",e=>{if("Enter"===e.key){const e=t.value.trim();e&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"search",data:e}}))}}),t.addEventListener("focus",()=>{t.select()})),document.querySelectorAll(".category-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-category");t&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"category-click",data:t}}))})}),document.querySelectorAll(".nav-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-nav");t&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"nav-click",data:t}}))})}),window.addEventListener("app-event",t=>{e&&t.detail&&e(t.detail.event,t.detail.data)}),window.addEventListener("popstate",()=>{window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"nav-click",data:"back"}}))}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.getElementById("videoContainer");e&&"block"===e.style.display&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"player-close"}}))}if(" "===e.key&&!e.target.matches("input, textarea, select")){const t=document.getElementById("videoPlayer");t&&(e.preventDefault(),t.paused?t.play():t.pause())}if("ArrowLeft"===e.key||"ArrowRight"===e.key){const t=document.getElementById("videoPlayer");if(t){e.preventDefault();const n="ArrowLeft"===e.key?-10:10;t.currentTime=Math.max(0,Math.min(t.duration,t.currentTime+n))}}}),window.addEventListener("resize",()=>{ae()}),ae()}function ae(){const e=window.innerWidth,t=document.getElementById("app");e<=480?(t.classList.add("mobile"),t.classList.remove("tablet","desktop")):e<=768?(t.classList.add("tablet"),t.classList.remove("mobile","desktop")):(t.classList.add("desktop"),t.classList.remove("mobile","tablet"))}function oe(){document.querySelectorAll(".category-btn").forEach(e=>{e.getAttribute("data-category")===window.AppState?.currentCategory?e.classList.add("active"):e.classList.remove("active")}),document.querySelectorAll(".nav-btn").forEach(e=>{const t=e.getAttribute("data-nav");"home"===t&&"home"===window.AppState?.currentPage?e.classList.add("active"):"back"===t&&window.AppState?.history.length>0?e.classList.remove("disabled"):e.classList.remove("active")});const e=document.getElementById("searchInput");e&&window.AppState?.searchQuery&&(e.value=window.AppState.searchQuery)}function se(e){if("back"===e)if(window.AppState?.history.length>1){window.AppState.history.pop();const e=window.AppState.history[window.AppState.history.length-1];if("search"===e.page)if(window.AppState.searchResults.results&&window.AppState.searchResults.results.length>0){w(window.AppState.searchResults,e.query),window.AppState.currentPage="search",window.AppState.searchQuery=e.query;const t=document.getElementById("searchInput");t&&(t.value=e.query)}else window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"search",data:e.query}}));else"home"===e.page?window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"category-click",data:window.AppState.currentCategory||"latest"}})):"detail"===e.page&&window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"drama-click",data:e.dramaId}}))}else window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"category-click",data:"latest"}}));else"home"===e&&(window.AppState.history=[{page:"home"}],window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"category-click",data:"latest"}})));oe()}function de(e,t="info",n=3e3){const i=document.querySelector(".notification");i&&i.remove();const a=document.createElement("div");a.className=`notification ${t}`,a.innerHTML=`\n        <div class="notification-content">\n            <i class="fas fa-${"error"===t?"exclamation-circle":"check-circle"}"></i>\n            <span>${e}</span>\n        </div>\n    `,document.body.appendChild(a),setTimeout(()=>{a.classList.add("show")},10),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},n)}window.player={openPlayer:B,closePlayer:te,getState:()=>L},window.uiUtils={toggleLiteMode:function(){const e=document.documentElement.classList.toggle("lite");window.AppState.isLiteMode=e,localStorage.setItem("liteMode",e),"detail"===window.AppState.currentPage&&window.AppState.currentDrama?window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"drama-click",data:window.AppState.currentDrama.id}})):window.dispatchEvent(new CustomEvent("app-event",{detail:{event:"category-click",data:window.AppState.currentCategory}}))},showNotification:de,confirmDialog:function(e,t){const n=document.querySelector(".confirm-dialog");n&&n.remove();const i=document.createElement("div");i.className="confirm-dialog",i.innerHTML=`\n        <div class="dialog-overlay"></div>\n        <div class="dialog-content">\n            <div class="dialog-message">${e}</div>\n            <div class="dialog-buttons">\n                <button class="dialog-btn cancel">Batal</button>\n                <button class="dialog-btn confirm">OK</button>\n            </div>\n        </div>\n    `,document.body.appendChild(i),i.querySelector(".cancel").addEventListener("click",()=>{i.remove()}),i.querySelector(".confirm").addEventListener("click",()=>{i.remove(),t&&t(!0)}),i.querySelector(".dialog-overlay").addEventListener("click",()=>{i.remove()})}};const re={currentPage:"home",currentCategory:"latest",currentDrama:null,searchQuery:"",searchResults:[],history:[],isLiteMode:!1,loading:!1};function ce(){re.isLiteMode=ne(),re.isLiteMode&&document.documentElement.classList.add("lite"),ie(le),k(),async function(){v();try{g(await i(),"latest")}catch(e){y("Gagal memuat konten awal")}}()}function le(e,t){switch(e){case"category-click":!async function(e){if(re.loading)return;re.currentCategory=e,re.currentPage="home",re.history.push({page:"home",category:e,timestamp:Date.now()}),oe(),v();try{let t;t="trending"===e?await a():await i(),g(t,e)}catch(e){y("Gagal memuat drama")}}(t);break;case"search":!async function(e){if(!e.trim())return;re.searchQuery=e,re.currentPage="search",re.history.push({page:"search",query:e,timestamp:Date.now()}),re.searchResults={results:[],hasMore:!1,total:0},v("Mencari...");try{const t=await o(e);re.searchResults=t,w(t,e)}catch(e){console.error("Search error:",e),y("Pencarian gagal")}}(t);break;case"drama-click":!async function(e){if(re.loading)return;re.currentPage="detail",re.history.push({page:"detail",dramaId:e,previousPage:re.currentPage,previousQuery:re.searchQuery}),v("Memuat detail...");try{const t=await s(e);re.currentDrama=t,f(t)}catch(e){y("Gagal memuat detail")}}(t);break;case"episode-click":E(t);break;case"nav-click":!function(e){switch(e){case"home":se("home");break;case"back":se("back");break;case"search":document.getElementById("searchInput").focus()}}(t);break;case"player-close":te();break;case"player-next":!function(){if(!re.currentDrama)return;const e=(window.currentEpisodeIndex||0)+1;e<re.currentDrama.episodes.length&&E(e)}();break;case"player-prev":!function(){if(!re.currentDrama)return;const e=(window.currentEpisodeIndex||0)-1;e>=0&&E(e)}()}}async function E(e){if(!re.currentDrama)return;const t=re.currentDrama.episodes[e];if(t)try{B(t,await d(t.vid),e)}catch(e){alert("Gagal memutar video")}}window.AppState=re,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ce):ce(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",ce):ce(),window.DramaWatch={api:{smartFetch:n,loadLatestDramas:i,loadTrendingDramas:a,searchDramas:o,loadDramaDetail:s,loadVideoSources:d,clearCache:l,proxyThumbnail:c},components:{renderGrid:g,renderDetail:f,renderSearchResults:w,renderLoading:v,renderError:y},player:{initVideoPlayer:k,openPlayer:B,closePlayer:te},ui:{detectLiteMode:ne,setupEventListeners:ie,navigate:se,updateUI:oe,showNotification:de}}}();