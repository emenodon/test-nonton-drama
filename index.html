<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nonton Drama</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
      const IS_LITE =
        (navigator.deviceMemory && navigator.deviceMemory <= 3) ||
        /Android [5-8]/i.test(navigator.userAgent) ||
        window.innerWidth <= 360;

      if (IS_LITE) {
        document.documentElement.classList.add("lite");
      }
    </script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --surface: #334155;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Search */
        .search-container {
            padding: 16px;
            background: var(--bg);
        }

        .search-box {
            display: flex;
            gap: 8px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 8px 12px;
            box-shadow: var(--shadow);
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 1rem;
            padding: 8px;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
        }

        .search-btn {
            background: var(--primary);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-btn:active {
            background: var(--primary-dark);
            transform: scale(0.95);
        }

        /* Categories */
        .categories {
            padding: 0 16px 16px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            background: var(--card-bg);
            border: none;
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
            transition: transform 0.15s, background 0.15s;
            flex-shrink: 0;
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Content */
        .content {
            padding: 0 16px 80px;
            min-height: 60vh;
        }

        /* Grid View */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            padding-bottom: 16px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            aspect-ratio: 2/3;
            position: relative;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-img {
            width: 100%;
            height: 70%;
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.9);
            background-size: cover;
            background-position: center;
            position: relative;
            z-index: 1;
        }

        .card-img img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }

        .card,
        .episode-item {
          contain: layout paint;
        }


        .card-info {
            padding: 12px;
            height: 30%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .card-title em {
          color: #facc15;
          font-style: normal;
        }

        .card-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .card,
        .card-img,
        .episode-item {
          will-change: transform;
          transform: translateZ(0);
        }

        body.scrolling .card,
        body.scrolling .search-box,
        body.scrolling .episode-item {
          box-shadow: none !important;
        }

        /* Episode List */
        .episode-list {
            padding: 0;
        }

        .episode-item {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 14px 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background 0.2s;
        }

        .episode-item:active {
            background: var(--surface);
        }

        .episode-title {
            font-weight: 500;
            font-size: 1rem;
        }

        .episode-play {
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* Video Player */
        .video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
            display: none;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-controls {
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .video-controls button {
            pointer-events: auto;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            font-size: 1.2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--surface);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            padding: 12px 16px;
            gap: 16px;
            border-top: 1px solid var(--surface);
            z-index: 100;
        }

        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s, background 0.15s;
            font-size: 0.8rem;
        }

        .nav-btn.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .nav-btn i {
            font-size: 1.2rem;
        }

        .global-watermark {
            position: fixed;
            bottom: 80px;
            right: 12px;
            z-index: 50;

            font-size: 0.65rem;
            opacity: 0.4;
            pointer-events: none;
        }

        .detail-title {
            font-size: clamp(1.1rem, 4.5vw, 1.4rem);
            font-weight: 700;
            margin-bottom: 16px;

            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .resolution-select {
          pointer-events: auto;
          background: rgba(0,0,0,0.55);
          color: white;
          border: none;
          padding: 6px 10px;
          border-radius: 8px;
          font-size: 0.8rem;
          outline: none;
          backdrop-filter: blur(8px);
        }

        .badges {
          position: absolute;
          top: 8px;
          left: 8px;
          display: flex;
          flex-wrap: wrap;
          gap: 6px;
          z-index: 5;
        }

        .badge {
          font-size: 0.65rem;
          font-weight: 700;
          padding: 4px 8px;
          border-radius: 999px;
          color: white;
          backdrop-filter: blur(6px);
          box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }

        .badge.hot { background: #ef4444; }
        .badge.new { background: #22c55e; }
        .badge.exclusive { background: #facc15; color: #1e293b; }
        .badge.dub { background: #3b82f6; }
        .badge.original { background: #8b5cf6; }
        .badge.saved { background: #64748b; }

        .app-title {
          font-size: 1.6rem;
          font-weight: 800;
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .app-subtitle {
          text-align: center;
          font-size: 0.75rem;
          opacity: 0.85;
          margin-top: 2px;
          letter-spacing: 0.5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
          .badge,
          .back-btn,
          .resolution-select {
            backdrop-filter: none;
          }
        }

        @media (max-width: 480px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }
            
            .card-title {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 360px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        /* ================= ULTRA LITE MODE ================= */
        .lite * {
          animation: none !important;
          transition: none !important;
        }

        .lite .card,
        .lite .search-box,
        .lite .episode-item,
        .lite .header,
        .lite .bottom-nav {
          box-shadow: none !important;
        }

        .lite .badge,
        .lite .back-btn,
        .lite .resolution-select {
          backdrop-filter: none !important;
        }

        .lite .grid {
          display: flex;
          flex-direction: column;
          gap: 10px;
        }

        .lite .card {
          display: flex;
          height: 100px;
          aspect-ratio: auto;
        }

        .lite .card-img {
          width: 70px;
          height: 100%;
          flex-shrink: 0;
        }

        .lite .card-info {
          height: auto;
          padding: 8px;
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }

        .lite .badges {
          top: 0px;
          left: auto;
          right: 0px;
          display: flex;
          position: absolute;
        }

        .lite .card-title {
          font-size: 0.9rem;
        }

        .lite .video-controls {
          opacity: 1 !important;
        }

        .lite .global-watermark {
          display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
      <h1 class="app-title">
        <i class="fas fa-play-circle"></i>
        Nonton Drama <span class="badge dub">Test</span>
      </h1>
    </header>


    <!-- Search -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Cari drama..." autocomplete="off">
            <button class="search-btn" onclick="searchDrama()">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>

    <!-- Categories -->
    <div class="categories">
        <button class="category-btn active" onclick="loadLatest()">Terbaru</button>
        <button class="category-btn" onclick="loadTrending()">Trending</button>
    </div>

    <!-- Content Area -->
    <main class="content" id="content">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Memuat...</p>
        </div>
    </main>

    <!-- Video Player -->
    <div class="video-container" id="videoContainer">
        <video class="video-player" id="videoPlayer" controls playsinline></video>
        <div class="video-controls">
          <button class="back-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
          </button>

          <div style="display:flex;gap:10px;align-items:center">
            <select id="resolutionSelect" class="resolution-select"></select>

            <button class="back-btn" onclick="prevEpisode()">
              <i class="fas fa-backward"></i>
            </button>
            <button class="back-btn" onclick="nextEpisode()">
              <i class="fas fa-forward"></i>
            </button>
          </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="loadLatest()">
            <i class="fas fa-home"></i>
            Home
        </button>
        <!-- <button class="nav-btn" onclick="focusSearch()">
            <i class="fas fa-search"></i>
            Cari
        </button> -->
        <button class="nav-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
            Kembali
        </button>
    </nav>

    <script>
      let currentEpisodes = [];
      let currentEpisodeIndex = -1;
      let currentVideoSources = {};
      let currentTimeCache = 0;

      /* ================= CONFIG ================= */
      const API_BASE = "https://melolo-api-azure.vercel.app/api/melolo";

      const PROXY_LIST = [
        'https://api.codetabs.com/v1/proxy?quest=',
        'https://thingproxy.freeboard.io/fetch/',
        'https://api.allorigins.win/raw?url='
      ];

      const cache = new Map();
      const CACHE_DURATION = 5 * 60 * 1000;

      /* ================= DOM ================= */
      const content = document.getElementById("content");
      const videoContainer = document.getElementById("videoContainer");
      const videoPlayer = document.getElementById("videoPlayer");
      const searchInput = document.getElementById("searchInput");

      /* ================= INIT ================= */
      document.addEventListener("DOMContentLoaded", () => {
        loadLatest();
        searchInput.addEventListener("keypress", e => {
          if (e.key === "Enter") searchDrama();
        });
        if (IS_LITE) {
          document.querySelector(".app-title")
            .insertAdjacentHTML("beforeend",
              `<span class="badge saved">LITE</span>`);
        }
      });

      /* ================= SMART FETCH ================= */
      async function smartFetch(endpoint, params = {}) {
        const cacheKey = endpoint + JSON.stringify(params);
        const cached = cache.get(cacheKey);

        if (cached && Date.now() - cached.time < CACHE_DURATION) {
          return cached.data;
        }

        const url = new URL(`${API_BASE}/${endpoint}`);
        Object.entries(params).forEach(([k, v]) => url.searchParams.append(k, v));
        const target = url.toString();

        async function tryFetch(fetchUrl) {
          try {
            const r = await fetch(fetchUrl);
            if (!r.ok) return null;
            const ct = r.headers.get("content-type") || "";
            if (!ct.includes("json")) return null;
            return await r.json();
          } catch {
            return null;
          }
        }

        let data = await tryFetch(target);
        if (!data) {
          for (const p of PROXY_LIST) {
            data = await tryFetch(p + encodeURIComponent(target));
            if (data) break;
          }
        }

        if (!data) throw "fetch failed";

        cache.set(cacheKey, { data, time: Date.now() });
        return data;
      }

      /* ================= LIST ================= */
      async function loadLatest() {
        showLoading();
        try {
          const json = await smartFetch("latest");
          setActiveCategory("latest");
          renderGrid(json.books || []);
        } catch {
          showError("Gagal memuat terbaru");
        }
      }

      async function loadTrending() {
        showLoading();
        try {
          const json = await smartFetch("trending");
          setActiveCategory("trending");
          renderGrid(json.books || []);
        } catch {
          showError("Gagal memuat trending");
        }
      }

      async function searchDrama() {
        const q = searchInput.value.trim();
        if (!q) return;

        showLoading();

        try {
          const json = await smartFetch("search", { query: q });

          const groups = json?.data?.search_data || [];

          const books = groups.flatMap(g => g.books || []);

          if (!books.length) {
            showError("Drama tidak ditemukan");
            return;
          }

          renderGrid(books);
        } catch (e) {
          console.error(e);
          showError("Pencarian gagal");
        }
      }

      function renderGrid(books) {
        if (!books.length) return showError("Tidak ada drama");
        if (IS_LITE) return renderGridLite(books);

        content.innerHTML = `
          <div class="grid">
            ${books.map(b => `
              <div class="card" onclick="loadDetail('${b.book_id}')">
                ${renderBadges(b)}
                <div class="card-img">
                  <img src="${thumbProxy(b.thumb_url)}"
                       loading="lazy"
                       decoding="async">
                </div>
                <div class="card-info">
                  <div class="card-title">
                    ${escapeHTML(b.search_high_light?.title?.rich_text || b.book_name)}
                  </div>
                  <div class="card-meta">${b.show_creation_status || ""}</div>
                </div>
              </div>
            `).join("")}
          </div>
        `;
      }

      function renderGridLite(books) {
        content.innerHTML = `<div class="grid" id="grid"></div>`;
        const grid = document.getElementById("grid");

        let i = 0;
        const CHUNK = 6;

        function renderChunk() {
          const slice = books.slice(i, i + CHUNK);

          slice.forEach(b => {
            const card = document.createElement("div");
            card.className = "card";
            card.onclick = () => loadDetail(b.book_id);

            card.innerHTML = `
              ${renderBadges(b)}
              <div class="card-img">
                <img src="${thumbProxy(b.thumb_url)}"
                     loading="lazy"
                     decoding="async">
              </div>
              <div class="card-info">
                <div class="card-title">${escapeHTML(b.book_name)}</div>
                <div class="card-meta">${b.show_creation_status || ""}</div>
              </div>
            `;

            grid.appendChild(card);
          });

          i += CHUNK;
          if (i < books.length) {
            requestAnimationFrame(renderChunk);
          }
        }

        renderChunk();
      }

      /* ================= DETAIL ================= */
      async function loadDetail(bookId) {
        showLoading();
        try {
          const json = await smartFetch(`detail/${bookId}`);
          const data = json.data.video_data;

          currentEpisodes = data.video_list;

          content.innerHTML = `
            <h2 class="detail-title">${data.series_title}</h2>
            <div class="episode-list">
              ${data.video_list.map((v, i) => `
                <div class="episode-item" onclick="playEpisode(${i})">
                  <div class="episode-title">Episode ${v.vid_index}</div>
                  <div class="episode-play"><i class="fas fa-play"></i></div>
                </div>
              `).join("")}
            </div>
          `;
        } catch {
          showError("Detail gagal dimuat");
        }
      }

      /* ================= STREAM ================= */
      function decodeUrl(str) {
        if (!str) return null;
        if (str.startsWith("http")) return str;

        try {
          return atob(str);
        } catch {
          return null;
        }
      }

      async function playVideo(vid) {
        try {
          const json = await smartFetch(`stream/${vid}`);
          const data = json?.data;

          let videoModel = data?.video_model;
          if (typeof videoModel === "string") {
            videoModel = JSON.parse(videoModel);
          }

          const list = videoModel?.video_list;
          if (!list) throw "no sources";

          currentVideoSources = {};
          const select = document.getElementById("resolutionSelect");
          select.innerHTML = "";

          Object.entries(list).forEach(([key, v]) => {
            if (!v?.main_url) return;

            const url = decodeUrl(v.main_url);
            if (!url) return;

            const label = v.definition || key.replace("video_", "") + "p";
            currentVideoSources[label] = url;

            const opt = document.createElement("option");
            opt.value = label;
            opt.textContent = label;
            select.appendChild(opt);
          });

          if (!Object.keys(currentVideoSources).length && data?.main_url) {
            currentVideoSources["Auto"] = data.main_url;
            select.innerHTML = `<option value="Auto">Auto</option>`;
          }

          const defaultRes = Object.keys(currentVideoSources).sort((a, b) => parseInt(a) - parseInt(b))[0];
          if (!defaultRes) throw "no playable url";

          select.value = defaultRes;

          const auto = videoModel.auto_definition;
          if (auto && currentVideoSources[auto]) {
            select.value = auto;
          }

          if (IS_LITE) {
            videoPlayer.preload = "metadata";
            videoPlayer.controlsList = "nofullscreen noremoteplayback";
          }

          videoPlayer.src = currentVideoSources[defaultRes];
          videoContainer.style.display = "block";
          videoPlayer.load();
          videoPlayer.play().catch(() => {});

          select.onchange = () => switchResolution(select.value);

        } catch (e) {
          console.error(e);
          alert("Video gagal diputar");
        }
      }

      /* ================= UI ================= */
      function goBack() {
        if (videoContainer.style.display === "block") {
          videoContainer.style.display = "none";
          videoPlayer.pause();
          videoPlayer.src = "";
        } else loadLatest();
      }

      function focusSearch() {
        searchInput.focus();
      }

      function setActiveCategory(type) {
        document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
        if (type === "latest") document.querySelectorAll(".category-btn")[0]?.classList.add("active");
        if (type === "trending") document.querySelectorAll(".category-btn")[1]?.classList.add("active");
      }

      function showLoading() {
        content.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>Memuat...</p>
          </div>
        `;
      }

      function showError(msg) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
            <p>${msg}</p>
          </div>
        `;
      }

      function playEpisode(index) {
        if (!currentEpisodes[index]) return;
        currentEpisodeIndex = index;

        currentTimeCache = 0;
        playVideo(currentEpisodes[index].vid);
      }
      function nextEpisode() {
        if (currentEpisodeIndex < currentEpisodes.length - 1) {
          playEpisode(currentEpisodeIndex + 1);
        }
      }

      function prevEpisode() {
        if (currentEpisodeIndex > 0) {
          playEpisode(currentEpisodeIndex - 1);
        }
      }

      /* AUTO PLAY NEXT */
      videoPlayer.addEventListener("ended", () => {
        nextEpisode();
      });
      videoPlayer.setAttribute("playsinline", true);
      videoPlayer.setAttribute("webkit-playsinline", true);
      
      let controlsTimeout;

      function showVideoControls() {
        const c = document.querySelector(".video-controls");
        c.style.opacity = "1";
        clearTimeout(controlsTimeout);
        controlsTimeout = setTimeout(() => {
          c.style.opacity = "0";
        }, 2500);
      }

      videoContainer.addEventListener("touchstart", showVideoControls);
      videoContainer.addEventListener("mousemove", showVideoControls);

      function thumbProxy(url) {
        if (!url) return "";
        const size = IS_LITE ? 240 : 400;
        const quality = IS_LITE ? 60 : 80;

        return `https://images.weserv.nl/?url=${encodeURIComponent(url)}&w=${size}&q=${quality}&output=jpg`;
      }

      function renderBadges(b) {
        const badges = [];

        if (b.is_hot === "1") badges.push(`<span class="badge hot">üî• HOT</span>`);
        if (b.is_new_book === "1") badges.push(`<span class="badge new">üÜï NEW</span>`);
        if (b.is_exclusive === "1") badges.push(`<span class="badge exclusive">‚≠ê EXCLUSIVE</span>`);
        if (b.is_dubbed === "1") badges.push(`<span class="badge dub">üéß DUB</span>`);
        if (b.is_native === "1") badges.push(`<span class="badge original">üå± ORIGINAL</span>`);
        if (b.in_bookshelf === "1") badges.push(`<span class="badge saved">‚úîÔ∏è SAVED</span>`);

        if (!badges.length) return "";
        return `<div class="badges">${badges.join("")}</div>`;
      }

      function escapeHTML(str = "") {
        return str.replace(/[&<>"']/g, m => ({
          "&":"&amp;",
          "<":"&lt;",
          ">":"&gt;",
          '"':"&quot;",
          "'":"&#039;"
        }[m]));
      }

      function switchResolution(res) {
        if (!currentVideoSources[res]) return;

        currentTimeCache = videoPlayer.currentTime;
        videoPlayer.src = currentVideoSources[res];
        videoPlayer.load();

        videoPlayer.onloadedmetadata = () => {
          videoPlayer.currentTime = currentTimeCache;
          videoPlayer.play().catch(() => {});
        };
      }

      let scrollTimer;
      window.addEventListener("scroll", () => {
        document.body.classList.add("scrolling");
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
          document.body.classList.remove("scrolling");
        }, 150);
      }, { passive: true });

      document.addEventListener("touchmove", () => {}, { passive: true });
    </script>
    <div class="global-watermark">¬© emenodon</div>

</body>
</html>
